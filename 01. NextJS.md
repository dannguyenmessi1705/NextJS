# NextJS

## 1. Giới thiệu
- NextJS là một framework ReactJS, giúp chúng ta xây dựng các ứng dụng ReactJS một cách dễ dàng và nhanh chóng.
- NextJS giúp chúng ta xây dựng các ứng dụng ReactJS với các tính năng như SSR (Server Side Rendering), SSG (Static Site Generation), API Routes, Image Optimization, File-system Routing, Code Splitting, CSS-in-JS, Fast Refresh, Fast Production Builds, Webpack, Babel, TypeScript, ESLint, Jest, và nhiều tính năng khác.
- NextJS giúp chúng ta xây dựng các ứng dụng ReactJS một cách dễ dàng và nhanh chóng, giúp chúng ta tập trung vào việc phát triển ứng dụng mà không cần phải lo lắng về cấu hình, tối ưu hóa, và các vấn đề khác.

## 2. Cài đặt
- Cài đặt NextJS thông qua npm:
```bash
npx create-next-app <project-name>
```
- Các tùy chọn sau khi chaỵ lệnh trên:
    + Sử dụng TypeScript: Chọn `Yes` nếu muốn sử dụng TypeScript.
    + Sử dụng ESLint: Chọn `Yes` nếu muốn sử dụng ESLint.
    + Sử dụng Tailwind CSS: Chọn `Yes` nếu muốn sử dụng Tailwind CSS.
    + Sử dụng `src` directory: Phiên bản `14.0.0` thì không nên chọn `Yes`.
    + Sử dụng `App Router`: Từ phiên bản `13.0.0` thì không nên chọn `Yes`.

## 3. Cấu trúc thư mục sau khi lựa chọn các tùy chọn trên
```
.
├── public : Chứa các file tĩnh như hình ảnh, font, ... 
├── .next : Chứa các file tạo ra sau khi build ứng dụng NextJS
├── node_modules : Chứa các thư viện cần thiết cho ứng dụng NextJS
├── app: Chứa các file chính của ứng dụng NextJS (components, pages, styles, ...)
│   ├── components : Chứa các file ReactJS, mỗi file ReactJS tương ứng với một component trong ứng dụng NextJS
│   ├── layouts : Chứa các file ReactJS, mỗi file ReactJS tương ứng với một layout trong ứng dụng NextJS
│   ├── pages : Chứa các file ReactJS, mỗi file ReactJS tương ứng với một route trong ứng dụng NextJS
│   ├── styles : Chứa các file CSS, SCSS, hoặc các file CSS-in-JS trong ứng dụng NextJS
│   └── api : Chứa các file API, mỗi file API tương ứng với một API trong ứng dụng NextJS
├── .gitignore : File chứa danh sách các file, thư mục không muốn đưa lên Git
├── package.json : File chứa thông tin về ứng dụng NextJS
├── tsconfig.json : File cấu hình TypeScript
├── .eslintrc.json : File cấu hình ESLint (Nếu sử dụng ESLint version < 9)
└── tailwind.config.js : File cấu hình Tailwind CSS
```

## 4. Cài đặt ESLint version 9 (Flat Config)
`Eslint` khi ra bản version 9 đã thay đổi cách cấu hình, không còn sử dụng file `.eslintrc.json` mà sử dụng file `eslint.config.js`. Để cài đặt `Eslint` version 9, chúng ta cần thực hiện các bước sau:
1. Cài đặt `Eslint` version 9:
```bash
$ npm install eslint@latest --save-dev
```

2. Cài đặt lại tất cả các plugin và rules cần thiết, với `--force` (do có thê `Eslint` version 9 không hỗ trợ tất cả các plugin và rules của phiên bản cũ):
```bash
$ npm clean-install --force
```
- Ngoài ra, có thể thêm dòng sau vào `package.json` để không cần sử dụng `--force`:
```json
"overrides": {
    "eslint": "^9.9.0" // Thay đổi version tùy theo phiên bản mới nhất
}
```

3. Tắt `Eslint` của `NextJS` trong file `next.config.js`:
```js
module.exports = {
    eslint: {
        ignoreDuringBuilds: true, // Tắt Eslint trong quá trình build
    },
}
```

4. Thêm quy tắc cấu hình `Eslint` vào `package.json` trước khi build ứng dụng:
```json
"scripts": {
    "lint": "eslint . ",
    "prebuild": "npm run lint"
}
```

5. Cài đặt cấu hình file `eslint`:
- Nếu ban đầu sử dụng `Eslint` version cũ, tồn tại file `.eslintrc.json`, chúng ta cần chuyển đổi file `.eslintrc.json` sang file `eslint.config.js`:
    ```bash
    $ npx @eslint/migrate-config .eslintrc.json <tên-file-cần-chuyển-đổi>
    ```
    > Sau khi chuyển đổi, file `.eslintrc.json` sẽ được chuyển đổi sang file `eslint.config.js`. Chúng ta cần xóa file `.eslintrc.json` để tránh xung đột cấu hình.
- Nếu trước đó chưa sử dụng `Eslint`, chúng ta cần tạo file cấu hình `Eslint` bằng cach chạy lệnh sau:
    ```bash
    $ npm init @eslint/config
    ```
    - Sau khi chạy lệnh trên, chúng ta sẽ được hỏi một số câu hỏi để tạo file cấu hình `Eslint`:
        + `How would you like to use ESLint?`: Chọn To check syntax and find problems
        + `What type of modules does your project use?`: Chọn JavaScript modules (import/export)
        + `Which framework does your project use?`: Với NextJS, chọn None of these
        + `Does your project use TypeScript?`: Chọn No nếu project không sử dụng TypeScript hoặc Yes nếu project sử dụng TypeScript
        `Where does your code run?`: Chọn Browser
        `Would you like to install them now?`: Chọn Yes
        `Which package manager does your project use?`: Chọn package manager mà bạn đang sử dụng (npm hoặc yarn)


6. Cài đặt `@eslint/js`, `@eslint/eslintrc`, và `@eslint/compat`  để sử dụng cấu hình `Eslint` version 9:
- `@eslint/js`: Cung cấp các quy tắc cần thiết cho `Eslint`.
- `@eslint/eslintrc`: Cung cấp cấu hình cơ bản cho `Eslint`.
- `@eslint/compat`: Cung cấp các hàm hỗ trợ tương thích với các plugin của `Eslint` cũ chưa hỗ trợ `flat config`.
```bash
$ npm install @eslint/eslintrc @eslint/js @eslint/compat --D
```

7. Cài đặt các plugin và rules cần thiết như:
- `eslint-plugin-react-hooks`:
- `@types/eslint__js`
- `typescript`
- `typescript-eslint`
- `eslint-plugin-prettier`
- `eslint-config-prettier`
- `prettier`

```bash
$ npm install --save-dev eslint @eslint/js @types/eslint__js typescript typescript-eslint eslint-plugin-prettier eslint-config-prettier

$ npm install --save-dev --save-exact prettier
```

8. Cấu hình lại file `eslint.config.js` thêm các cấu hình cần thiết từ các plugin và rules đã cài đặt theo hướng dẫn trong ví dụ sau:
> eslint.config.js
```js
import path from "node:path";
import { fileURLToPath } from "node:url";
import js from "@eslint/js";
import ts from "typescript-eslint";
import prettierConfigRecommended from "eslint-plugin-prettier/recommended";
import { FlatCompat } from "@eslint/eslintrc";
import { fixupConfigRules } from "@eslint/compat"; // import hàm fixupConfigRules để thêm cấu hình cho `plugin` chưa hỗ trợ flat config

const __filename = fileURLToPath(import.meta.url); // Lấy đường dẫn tới file hiện tại
const __dirname = path.dirname(__filename); // Lấy đường dẫn tới thư mục chứa file hiện tại
const compat = new FlatCompat({ // Khởi tạo FlatCompat
  baseDirectory: __dirname, // Thư mục chứa file cấu hình
  recommendedConfig: js.configs.recommended, // Cấu hình mặc định của `@eslint/js`
  allConfig: js.configs.all, // Tất cả cấu hình của `@eslint/js`
});
const patchedConfig = fixupConfigRules([
  ...compat.extends("next/core-web-vitals"),
]); // Thêm cấu hình cho `plugin` chưa hỗ trợ flat config, bên trong hàm `extends` có thể thêm nhiều `plugin` khác

const config = [
  ...patchedConfig, // Thiết lập eslint cho các `plugin` chưa hỗ trợ flat config
  ...ts.configs.recommended, // Thiết lập eslint cho TypeScript
  prettierConfigRecommended, // Thiết lập eslint cho Prettier
  // Thêm các cấu hình ở đây nếu hỗ trợ flat config
  {
    ignores: [".next/*"], // Không kiểm tra trong thư mục .next
  },
];

export default config;
```

> Sau khi cấu hình xong, chúng ta có thể chạy lệnh `npm run lint` để kiểm tra lỗi trong ứng dụng NextJS. Nếu không có lỗi nào xuất hiện, chứng tỏ cấu hình `Eslint` đã hoạt động đúng.